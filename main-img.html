<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>chapter 2, canny edge detector</title>
    <script src="js/jsfeat-min.js"></script>
    <script src="js/common-jsfeat.js"></script>
    <script src="js/pca.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/cvw.css">
</head>

<body>
    <div id="images" class="canvas-parent">
        <canvas id="initCanvas" class="canvas-img"></canvas>
    </div>
    <script>
        var canvas = document.getElementById('initCanvas');
        var context = canvas.getContext('2d');
        var image = new Image();
        image.src = 'img/23.png';

        image.onload = function () {
            var cols = image.width;
            var rows = image.height;
            canvas.width = cols;
            canvas.height = rows;
            context.drawImage(image, 0, 0, image.width, image.height, 0, 0, cols, rows);
            var canvasParent = document.getElementById('images');
            var imageData = context.getImageData(0, 0, cols, rows);

            var kernelSize = 5;
            var lowThresh = 80;
            var highThresh = 40;

            var dataBuffer = new jsfeat.data_t(cols * rows, imageData.data.buffer);
            var mat = new jsfeat.matrix_t(cols, rows, jsfeat.U8C4_t, dataBuffer);
            var matGray = new jsfeat.matrix_t(mat.cols, mat.rows, jsfeat.U8C1_t);
            jsfeat.imgproc.grayscale(mat.data, mat.cols, mat.rows, matGray);

            var canny = new jsfeat.matrix_t(cols, rows, jsfeat.U8C1_t);
            jsfeat.imgproc.gaussian_blur(matGray, canny, kernelSize);
            jsfeat.imgproc.canny(canny, canny, lowThresh, highThresh);

            drawMat(canny, canvasParent, 'canvas-img');

            console.log("canny: " + canny);
            console.log(canny);
            console.log(canny.data);
            console.log("PCA");
            console.log(PCA);
            var data = [[40, 50, 60], [50, 70, 60], [80, 70, 90], [50, 60, 80]];
            var vectors = PCA.getEigenVectors(data);
            console.log("vectors");
            console.log(vectors);
            var first = PCA.computePercentageExplained(vectors, vectors[0])
            console.log("first");
            console.log(first);
            var topTwo = PCA.computePercentageExplained(vectors, vectors[0], vectors[1])
            console.log("topTwo");
            console.log(topTwo);
            var adData = PCA.computeAdjustedData(data,vectors[0]);
            console.log("addData");
            console.log(adData);


        };
    </script>
</body>

</html>